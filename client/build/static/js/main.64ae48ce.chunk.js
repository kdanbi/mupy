(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,a){},24:function(e,t,a){e.exports=a.p+"static/media/mupy_logo.731fe5d1.png"},25:function(e,t,a){e.exports=a.p+"static/media/mupy_name.337e84c1.svg"},26:function(e,t,a){e.exports=a.p+"static/media/header-left.ed7d4d6b.svg"},27:function(e,t,a){e.exports=a.p+"static/media/group.a2fedce9.svg"},32:function(e,t,a){e.exports=a(55)},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){},55:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),o=a(23),i=a.n(o),r=(a(37),a(5)),c=a(6),l=a(8),u=a(7),m=a(9),p=a(14),d=a(10),h=(a(38),a(39),a(24)),f=a.n(h),g=a(25),b=a.n(g),v=a(31).a.div({hidden:{opacity:0},visible:{opacity:1}}),y=function(e){function t(){var e,a;Object(r.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={getStarted:!1,isVisible:!0},a.changeState=function(){a.setState({getStarted:!0})},a.handleSubmit=function(e){e.preventDefault(),a.setState({user_name:a.input.value})},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;setInterval(function(){e.setState({isVisible:!e.state.isVisible})},1e3)}},{key:"render",value:function(){return this.state.getStarted?s.a.createElement("section",{className:"landing-page"},s.a.createElement("div",{className:"landing-page__partB"},s.a.createElement("img",{pose:this.state.isVisible?"visible":"hidden",className:"landing-page__partB---logo",src:b.a,alt:"logo"}),s.a.createElement("a",{className:"landing-page__partB--intro",href:"test"}," Discover your sound"))):s.a.createElement("section",{className:"landing-page"},s.a.createElement(v,{pose:this.state.isVisible?"visible":"hidden",className:"landing-page__partA"},s.a.createElement("img",{className:"landing-page__partA--logo",onClick:this.changeState,src:f.a,alt:"logo"}),s.a.createElement("h2",{className:"landing-page__partA--intro"},"Music therapy anytime.")))}}]),t}(s.a.Component),E=(a(13),a(26)),j=a.n(E),w=a(27),O=a.n(w),N=function(e){return s.a.createElement("div",{className:"chat-header"},s.a.createElement(p.b,{to:"/"},s.a.createElement("img",{className:"chat-header__left",src:j.a,alt:"app logo"})),s.a.createElement("img",{className:"chat-header__right",src:O.a,alt:"app logo"}))},k=function(e){function t(){return Object(r.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"bot-message-container",ref:this.props.thisRef},s.a.createElement("div",{className:"bot-avatar"}),s.a.createElement("div",{className:"chat-bubble bot"},this.props.message))}}]),t}(s.a.Component),M=function(e){function t(){return Object(r.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"user-message-container",ref:this.props.thisRef},s.a.createElement("div",{className:"chat-bubble user"},this.props.message))}}]),t}(s.a.Component),_=a(30),I=new(a.n(_).a)({clientId:"f5e8e6f86fdd4361a33a3daaa5bcf808",clientSecret:"71a41656726a455a9cc526e9cbf2b168",redirectUri:"https://mupy-server.herokuapp.com/callback"}),R={userMessages:[],botMessages:[],botGreeting:"Hi I'm mupy - your music therapy bot! What's your name?",botLoading:!1,moodIdentifier:[],spotifyURL:"",shouldContinue:!1},S=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateUserMessages=function(e){if(e){var t=a.state.userMessages,n=a.state.botMessages;a.setState({userMessages:t.concat(e),botLoading:!0,newMessage:e,shouldContinue:!0});var s=new Request("https://api.dialogflow.com/v1/query?v=20150910&contexts=shop&lang=en&query="+e+"&sessionId=12345",{headers:new Headers({Authorization:"Bearer 09b0b56442394d17907d2f63d856faf2"})});fetch(s).then(function(e){return e.json()}).then(function(e){var t=e.result.fulfillment.speech,s=Object.keys(e.result.parameters);a.setState({botMessages:n.concat(t),botLoading:!1,moodIdentifier:s})}).catch(function(e){console.log("ERROR:",e),a.setState({botMessages:n.concat("?"),botLoading:!1})})}},a.scrollBubble=function(e){null!=e&&e.scrollIntoView(!0)},a.showMessages=function(){for(var e=a.state.userMessages,t=a.state.botMessages,n=[],o=0;o<e.length;o++){if(o===e.length-1){t[o]?(n.push(s.a.createElement(M,{message:e[o]})),n.push(s.a.createElement(k,{message:t[o],thisRef:a.scrollBubble}))):n.push(s.a.createElement(M,{message:e[o],thisRef:a.scrollBubble}));break}n.push(s.a.createElement(M,{message:e[o]})),n.push(s.a.createElement(k,{message:t[o]}))}return n.unshift(s.a.createElement(k,{message:a.state.botGreeting,thisRef:0===o?a.scrollBubble:""})),s.a.createElement("div",{className:"msg-container"},n)},a.onInput=function(e){e.preventDefault();var t=e.target.message.value;a.updateUserMessages(t),e.target.message.value=""},a.componentDidUpdate=function(){var e=new Request("https://api.dialogflow.com/v1/query?v=20150910&contexts=shop&lang=en&query="+a.state.newMessage+"&sessionId=12345",{headers:new Headers({Authorization:"Bearer 09b0b56442394d17907d2f63d856faf2"})});(!a.state.moodIdentifier.length>0||!0===a.state.shouldContinue)&&fetch(e).then(function(e){return e.json()}).then(function(e){return Object.keys(e.result.parameters)}).then(function(e){I.searchPlaylists(e.join(", ")).then(function(t){console.log("playlists",t.body.playlists.items);var n=Math.floor(Math.random()*t.body.playlists.items.length);console.log(t.body.playlists.items);var s=t.body.playlists.items[n].uri.slice(17),o="https://open.spotify.com/embed/playlist/".concat(s);a.setState({spotifyURL:o,moodIdentifier:e,shouldContinue:!1})}).catch(function(e){console.log(e)})})},a.state=R,a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.getHashParams().access_token;e&&I.setAccessToken(e)}},{key:"getHashParams",value:function(){var e,t={},a=/([^&;=]+)=?([^&;]*)/g,n=window.location.hash.substring(1);for(e=a.exec(n);e;)t[e[1]]=decodeURIComponent(e[2]),e=a.exec(n);return t}},{key:"render",value:function(){return console.log("mood",this.state.moodIdentifier),console.log("spotify",this.state.spotifyURL),s.a.createElement("div",{className:"app-container"},s.a.createElement("div",{className:"chat-container"},s.a.createElement(N,null),this.showMessages(),s.a.createElement("form",{onSubmit:this.onInput,className:"input-container"},s.a.createElement("input",{id:"chat",type:"text",name:"message",placeholder:"Your message here."}),s.a.createElement("button",{type:"submit",className:"input-submit"})),s.a.createElement("iframe",{title:"this is unique",id:"spotify",src:this.state.spotifyURL,frameBorder:"0",allowtransparency:"true",allow:"encrypted-media"})))}}]),t}(s.a.Component),B=function(e){function t(){return Object(r.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement(p.a,null,s.a.createElement("div",{className:"App"},s.a.createElement(d.c,null,s.a.createElement(d.a,{exact:!0,path:"/",component:y}),s.a.createElement(d.a,{path:"/chat",component:S}))))}}]),t}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[32,1,2]]]);
//# sourceMappingURL=main.64ae48ce.chunk.js.map